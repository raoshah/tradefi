<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeFi</title>
    <style>
        .share {
            text-align: center;
        }
    </style>
</head>

<body>
    <button style="text-align: center; padding: 2%; background-color: aqua;" id="refreshButton">Refresh</button>
    <button style="text-align: center; padding: 2%; background-color: aqua;"><a
            style="text-decoration: none; color: black;" href="/">Stocks</a></button>
            <button style="text-align: center; padding: 2%; background-color: aqua;" ><a style="text-decoration: none; color: black;" href="/backtest">Back Test</a></button>
    <div id="dataContainer"></div>


    <script>
        const symbol_token_dict = {
            "INDHOTEL28NOV24FUT": "38775",
    "INDIGO28NOV24FUT": "38779",
    "IOC28NOV24FUT": "38786",
    "LAURUSLABS28NOV24FUT": "38799",
    "MOTHERSON28NOV24FUT": "38840",
    "PERSISTENT28NOV24FUT": "38886",
    "GLENMARK28NOV24FUT": "38712",
    "SYNGENE28NOV24FUT": "38939",
    "POWERGRID28NOV24FUT": "38908",
    "BAJFINANCE28NOV24FUT": "35859",
    "NATIONALUM28NOV24FUT": "38853",
    "MGL28NOV24FUT": "38839",
    "TATASTEEL28NOV24FUT": "38955",
    "PEL28NOV24FUT": "38878",
    "SRF28NOV24FUT": "38936",
    "DIVISLAB28NOV24FUT": "38689",
    "IDFCFIRSTB28NOV24FUT": "38766",
    "TITAN28NOV24FUT": "38975",
    "BATAINDIA28NOV24FUT": "35984",
    "SHREECEM28NOV24FUT": "38933",
    "JKCEMENT28NOV24FUT": "38791",
    "SHRIRAMFIN28NOV24FUT": "38934",
    "ACC28NOV24FUT": "35593",
    "VEDL28NOV24FUT": "38987",
    "BERGEPAINT28NOV24FUT": "36417",
    "MANAPPURAM28NOV24FUT": "38824",
    "RAMCOCEM28NOV24FUT": "38911",
    "HDFCLIFE28NOV24FUT": "38739",
    "CANFINHOME28NOV24FUT": "36711",
    "HAVELLS28NOV24FUT": "38731",
    "BHARATFORG28NOV24FUT": "36420",
    "BANKBARODA28NOV24FUT": "35983",
    "MARICO28NOV24FUT": "38830",
    "BANDHANBNK28NOV24FUT": "35967",
    "PAGEIND28NOV24FUT": "38876",
    "BHARTIARTL28NOV24FUT": "36629",
    "JSWSTEEL28NOV24FUT": "38792",
    "BANKNIFTY27NOV24FUT": "35013",
    "CROMPTON28NOV24FUT": "37750",
    "BAJAJ-AUTO28NOV24FUT": "35855",
    "EXIDEIND28NOV24FUT": "38702",
    "POLYCAB28NOV24FUT": "38907",
    "M&M28NOV24FUT": "38821",
    "TVSMOTOR28NOV24FUT": "38978",
    "NAUKRI28NOV24FUT": "38862",
    "RBLBANK28NOV24FUT": "38912",
    "DLF28NOV24FUT": "38694",
    "ULTRACEMCO28NOV24FUT": "38980",
    "GODREJCP28NOV24FUT": "38715",
    "NAVINFLUOR28NOV24FUT": "38863",
    "IGL28NOV24FUT": "38774",
    "TATACOMM28NOV24FUT": "38941",
    "CHOLAFIN28NOV24FUT": "37283",
    "ADANIENT28NOV24FUT": "35596",
    "TATAPOWER28NOV24FUT": "38954",
    "COALINDIA28NOV24FUT": "37285",
    "GMRINFRA28NOV24FUT": "38713",
    "ITC28NOV24FUT": "38789",
    "GNFC28NOV24FUT": "38714",
    "HEROMOTOCO28NOV24FUT": "38740",
    "VOLTAS28NOV24FUT": "38988",
    "PNB28NOV24FUT": "38893",
    "ONGC28NOV24FUT": "38875",
    "GODREJPROP28NOV24FUT": "38723",
    "GAIL28NOV24FUT": "38704",
    "COFORGE28NOV24FUT": "37286",
    "GRANULES28NOV24FUT": "38726",
    "PETRONET28NOV24FUT": "38887",
    "HDFCAMC28NOV24FUT": "38733",
    "COLPAL28NOV24FUT": "37287",
    "AUBANK28NOV24FUT": "35789",
    "ASHOKLEY28NOV24FUT": "35774",
    "LT28NOV24FUT": "38816",
    "OBEROIRLTY28NOV24FUT": "38873",
    "DEEPAKNTR28NOV24FUT": "38469",
    "ICICIPRULI28NOV24FUT": "38753",
    "TATACHEM28NOV24FUT": "38940",
    "TATAMOTORS28NOV24FUT": "38953",
    "CHAMBLFERT28NOV24FUT": "37269",
    "SIEMENS28NOV24FUT": "38935",
    "ICICIBANK28NOV24FUT": "38751",
    "MIDCPNIFTY25NOV24FUT": "36540",
    "GRASIM28NOV24FUT": "38728",
    "SUNPHARMA28NOV24FUT": "38937",
    "PVRINOX28NOV24FUT": "38910",
    "PIIND28NOV24FUT": "38892",
    "METROPOLIS28NOV24FUT": "38834",
    "AXISBANK28NOV24FUT": "35854",
    "M&MFIN28NOV24FUT": "38823",
    "WIPRO28NOV24FUT": "38989",
    "SAIL28NOV24FUT": "38924",
    "PIDILITIND28NOV24FUT": "38889",
    "SBIN28NOV24FUT": "38932",
    "INDIAMART28NOV24FUT": "38778",
    "FEDERALBNK28NOV24FUT": "38703",
    "NESTLEIND28NOV24FUT": "38865",
    "HDFCBANK28NOV24FUT": "38737",
    "HINDALCO28NOV24FUT": "38741",
    "BPCL28NOV24FUT": "36667",
    "AUROPHARMA28NOV24FUT": "35790",
    "BHEL28NOV24FUT": "36630",
    "ABCAPITAL28NOV24FUT": "35478",
    "MUTHOOTFIN28NOV24FUT": "38844",
    "ATUL28NOV24FUT": "35779",
    "ASIANPAINT28NOV24FUT": "35775",
    "MRF28NOV24FUT": "38843",
    "GUJGASLTD28NOV24FUT": "38729",
    "DABUR28NOV24FUT": "37773",
    "BRITANNIA28NOV24FUT": "36668",
    "ZYDUSLIFE28NOV24FUT": "38996",
    "MFSL28NOV24FUT": "38835",
    "HINDCOPPER28NOV24FUT": "38744",
    "ABBOTINDIA28NOV24FUT": "35477",
    "DALBHARAT28NOV24FUT": "38467",
    "OFSS28NOV24FUT": "38874",
    "MARUTI28NOV24FUT": "38832",
    "IEX28NOV24FUT": "38767",
    "JINDALSTEL28NOV24FUT": "38790",
    "BALKRISIND28NOV24FUT": "35966",
    "APOLLOHOSP28NOV24FUT": "35600",
    "INDUSINDBK28NOV24FUT": "38780",
    "PFC28NOV24FUT": "38888",
    "CUMMINSIND28NOV24FUT": "37765",
    "LALPATHLAB28NOV24FUT": "38798",
    "IRCTC28NOV24FUT": "38788",
    "LTIM28NOV24FUT": "38818",
    "TORNTPHARM28NOV24FUT": "38976",
    "LTTS28NOV24FUT": "38819",
    "LICHSGFIN28NOV24FUT": "38812",
    "MCX28NOV24FUT": "38833",
    "TECHM28NOV24FUT": "38970",
    "NTPC28NOV24FUT": "38872",
    "HINDUNILVR28NOV24FUT": "38750",
    "NIFTY28NOV24FUT": "35089",
    "BOSCHLTD28NOV24FUT": "36636",
    "ALKEM28NOV24FUT": "35598",
    "BIOCON28NOV24FUT": "36635",
    "HAL28NOV24FUT": "38730",
    "UNITDSPR28NOV24FUT": "38983",
    "JUBLFOOD28NOV24FUT": "38793",
    "BAJAJFINSV28NOV24FUT": "35858",
    "CANBK28NOV24FUT": "36674",
    "INDUSTOWER28NOV24FUT": "38781",
    "ICICIGI28NOV24FUT": "38752",
    "IDEA28NOV24FUT": "38756",
    "LTF28NOV24FUT": "38817",
    "NMDC28NOV24FUT": "38871",
    "BSOFT28NOV24FUT": "36673",
    "ABB28NOV24FUT": "35137",
    "UBL28NOV24FUT": "38979",
    "ADANIPORTS28NOV24FUT": "35597",
    "UPL28NOV24FUT": "38986",
    "IPCALAB28NOV24FUT": "38787",
    "ASTRAL28NOV24FUT": "35778",
    "AARTIIND28NOV24FUT": "35129",
    "NIFTYNXT5029NOV24FUT": "35150",
    "ABFRL28NOV24FUT": "35592",
    "ESCORTS28NOV24FUT": "38701",
    "CUB28NOV24FUT": "37751",
    "SUNTV28NOV24FUT": "38938",
    "LUPIN28NOV24FUT": "38820",
    "KOTAKBANK28NOV24FUT": "38796",
    "SBICARD28NOV24FUT": "38929",
    "EICHERMOT28NOV24FUT": "38697",
    "CONCOR28NOV24FUT": "37288",
    "FINNIFTY26NOV24FUT": "35117",
    "RECLTD28NOV24FUT": "38913",
    "COROMANDEL28NOV24FUT": "37290",
    "TCS28NOV24FUT": "38969",
    "DIXON28NOV24FUT": "38693",
    "HINDPETRO28NOV24FUT": "38745",
    "AMBUJACEM28NOV24FUT": "35599",
    "MPHASIS28NOV24FUT": "38841",
    "INFY28NOV24FUT": "38783",
    "APOLLOTYRE28NOV24FUT": "35601",
    "TRENT28NOV24FUT": "38977",
    "SBILIFE28NOV24FUT": "38931",
    "DRREDDY28NOV24FUT": "38695",
    "BEL28NOV24FUT": "36366",
    "HCLTECH28NOV24FUT": "38732",
    "CIPLA28NOV24FUT": "37284",
    "TATACONSUM28NOV24FUT": "38952",
    "RELIANCE28NOV24FUT": "38914",
    "ZINCMINI29NOV24FUT": "436243",
    "NATURALGAS25NOV24FUT": "435097",
    "SILVERM29NOV24FUT": "426307",
    "CRUDEOIL19NOV24FUT": "434271",
    "COTTONCNDY29NOV24FUT": "435689",
    "MENTHAOIL29NOV24FUT": "435345",
    "GOLDGUINEA29NOV24FUT": "437992",
    "NATGASMINI25NOV24FUT": "435098",
    "NICKEL29NOV24FUT": "436240",
    "ALUMINIUM29NOV24FUT": "436236",
    "STEELREBAR29NOV24FUT": "436241",
    "KAPAS29NOV24FUT": "430067",
    "MCXMETLDEX20NOV24FUT": "438426",
    "GOLDPETAL29NOV24FUT": "437993",
    "LEADMINI29NOV24FUT": "436238",
    "ALUMINI29NOV24FUT": "436235",
    "COTTONOIL29NOV24FUT": "440903",
    "ZINC29NOV24FUT": "436242",
    "LEAD29NOV24FUT": "436239",
    "CRUDEOILM19NOV24FUT": "434272",
    "MCXBULLDEX26NOV24FUT": "438575",
    "SILVERMIC29NOV24FUT": "429116",

            "THIS IS LAST >>>>>>REFRESH__AGAIN>>>>>> COPPER29NOV24FUT": "436237"
        };

        async function fetchCandleDataSequential(tokens) {
            for (let token of tokens) {
                const tokenName = Object.keys(symbol_token_dict).find(key => symbol_token_dict[key] === token).replace(/-EQ$/, '');
                try {
                    const response = await fetch(`/get_fut_data/${token}/${tokenName}`);
                    const data = await response.json();
                    displayData(token, data);
                } catch (error) {
                    console.error(`Error fetching data for token ${token}:`, error);
                }
            }
        }

        function displayData(token, data) {
            const dataContainer = document.getElementById('dataContainer');

            const tokenName = Object.keys(symbol_token_dict).find(key => symbol_token_dict[key] === token);
            const today_len = data.data.length - 1;
            const yesterday_len = data.data.length - 2;
            const todayHigh = parseFloat(data.data[today_len]['2']);
            const todayLow = parseFloat(data.data[today_len]['3']);
            const yesterdayHigh = parseFloat(data.data[yesterday_len]['2']);
            const yesterdayLow = parseFloat(data.data[yesterday_len]['3']);
            const todayVol = parseFloat(data.data[today_len]['5']);
            const yesterdayVol = parseFloat(data.data[yesterday_len]['5']);

            const div = document.createElement('div');
            div.innerHTML = ` <br> <p class='share' > <b>${tokenName}:</b> ${JSON.stringify(data.data[today_len]['4'])}</p>
            <p class='share' > <b>Today:</b>  High: ${todayHigh} -- Low: ${todayLow} -- Volume: ${todayVol} </p>
            <p class='share' > <b>Yesterday:</b>  High: ${yesterdayHigh} -- Low: ${yesterdayLow} -- Volume: ${yesterdayVol} </p>
            <hr>`;



            if (todayHigh > yesterdayHigh && todayLow < yesterdayLow) {
                div.style.color = 'green';
                div.style.backgroundColor = 'chartreuse';
            } else {
                div.style.color = 'black';
            }


            if (dataContainer.firstChild) {
                dataContainer.insertBefore(div, dataContainer.firstChild);
            } else {
                dataContainer.appendChild(div);
            }
        }

        const tokens = Object.values(symbol_token_dict);
        console.log(tokens)

        fetchCandleDataSequential(tokens);

        function refreshData() {
            const dataContainer = document.getElementById('dataContainer');
            dataContainer.innerHTML = '';
            fetchCandleDataSequential(tokens);
        }
        document.getElementById('refreshButton').addEventListener('click', refreshData);
    </script>

</body>

</html>
