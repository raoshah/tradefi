<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeFi</title>
    <style>
        .share {
            text-align: center;
        }
    </style>
</head>

<body>
    <button style="text-align: center; padding: 2%; background-color: aqua;" id="refreshButton">Refresh</button>
    <button style="text-align: center; padding: 2%; background-color: aqua;" ><a style="text-decoration: none; color: black;" href="/">Stocks</a></button>
    <div id="dataContainer"></div>


    <script>
        const symbol_token_dict = {
            "HDFCBANK29FEB24FUT": "71671",
            "NTPC29FEB24FUT": "71860",
            "SHREECEM25JAN24FUT": "55487",
            "WIPRO29FEB24FUT": "71920",
            "TATAMOTORS29FEB24FUT": "71906",
            "ULTRACEMCO25JAN24FUT": "55513",
            "ONGC25JAN24FUT": "55463",
            "BAJAJFINSV29FEB24FUT": "71464",
            "NTPC25JAN24FUT": "55460",
            "HEROMOTOCO25JAN24FUT": "55396",
            "DIVISLAB25JAN24FUT": "55373",
            "INFY29FEB24FUT": "71696",
            "BRITANNIA29FEB24FUT": "71492",
            "M&M29FEB24FUT": "71840",
            "UPL29FEB24FUT": "71917",
            "ASIANPAINT29FEB24FUT": "71457",
            "UPL25JAN24FUT": "55514",
            "AXISBANK25JAN24FUT": "55337",
            "TITAN25JAN24FUT": "55506",
            "ICICIBANK29FEB24FUT": "71680",
            "LT29FEB24FUT": "71836",
            "SBIN29FEB24FUT": "71895",
            "ITC29FEB24FUT": "71811",
            "GRASIM25JAN24FUT": "55388",
            "TATACONSUM25JAN24FUT": "55498",
            "BAJFINANCE29FEB24FUT": "71465",
            "M&M25JAN24FUT": "55437",
            "HINDUNILVR29FEB24FUT": "71679",
            "HCLTECH29FEB24FUT": "71669",
            "MARUTI25JAN24FUT": "55441",
            "GRASIM29FEB24FUT": "71663",
            "DIVISLAB29FEB24FUT": "71555",
            "BAJFINANCE25JAN24FUT": "55340",
            "INDUSINDBK25JAN24FUT": "55417",
            "BAJAJ-AUTO25JAN24FUT": "55338",
            "DRREDDY29FEB24FUT": "71577",
            "CIPLA25JAN24FUT": "55360",
            "SBILIFE25JAN24FUT": "55483",
            "HDFCBANK25JAN24FUT": "55394",
            "HINDALCO25JAN24FUT": "55397",
            "RELIANCE25JAN24FUT": "55480",
            "TCS25JAN24FUT": "55504",
            "BAJAJ-AUTO29FEB24FUT": "71463",
            "EICHERMOT29FEB24FUT": "71578",
            "HCLTECH25JAN24FUT": "55392",
            "INFY25JAN24FUT": "55419",
            "WIPRO25JAN24FUT": "55519",
            "HEROMOTOCO29FEB24FUT": "71673",
            "HINDUNILVR25JAN24FUT": "55400",
            "TECHM29FEB24FUT": "71910",
            "BHARTIARTL29FEB24FUT": "71487",
            "BHARTIARTL25JAN24FUT": "55349",
            "TECHM25JAN24FUT": "55505",
            "TCS29FEB24FUT": "71909",
            "POWERGRID25JAN24FUT": "55474",
            "TATASTEEL25JAN24FUT": "55503",
            "SBIN25JAN24FUT": "55486",
            "TITAN29FEB24FUT": "71911",
            "ADANIPORTS29FEB24FUT": "71451",
            "KOTAKBANK29FEB24FUT": "71831",
            "ADANIPORTS25JAN24FUT": "55326",
            "SHREECEM29FEB24FUT": "71896",
            "ASIANPAINT25JAN24FUT": "55332",
            "AXISBANK29FEB24FUT": "71462",
            "ONGC29FEB24FUT": "71863",
            "COALINDIA29FEB24FUT": "71499",
            "COALINDIA25JAN24FUT": "55361",
            "HDFCLIFE29FEB24FUT": "71672",
            "NESTLEIND25JAN24FUT": "55458",
            "RELIANCE29FEB24FUT": "71891",
            "ITC25JAN24FUT": "55423",
            "CIPLA29FEB24FUT": "71498",
            "ICICIBANK25JAN24FUT": "55401",
            "HINDALCO29FEB24FUT": "71674",
            "TATAMOTORS25JAN24FUT": "55499",
            "JSWSTEEL29FEB24FUT": "71829",
            "LT25JAN24FUT": "55433",
            "TATASTEEL29FEB24FUT": "71908",
            "NESTLEIND29FEB24FUT": "71858",
            "KOTAKBANK25JAN24FUT": "55428",
            "EICHERMOT25JAN24FUT": "55377",
            "SBILIFE29FEB24FUT": "71894",
            "DRREDDY25JAN24FUT": "55376",
            "MARUTI29FEB24FUT": "71844",
            "ULTRACEMCO29FEB24FUT": "71916",
            "INDUSINDBK29FEB24FUT": "71692",
            "JSWSTEEL25JAN24FUT": "55426",
            "POWERGRID29FEB24FUT": "71886",
            "BRITANNIA25JAN24FUT": "55354",
            "BAJAJFINSV25JAN24FUT": "55339",
            "TATACONSUM29FEB24FUT": "71905",
            "HDFCLIFE25JAN24FUT": "55395"
        };

        async function fetchCandleDataSequential(tokens) {
            for (let token of tokens) {
                const tokenName = Object.keys(symbol_token_dict).find(key => symbol_token_dict[key] === token).replace(/-EQ$/, '');
                try {
                    const response = await fetch(`/get_fut_data/${token}/${tokenName}`);
                    const data = await response.json();
                    displayData(token, data);
                } catch (error) {
                    console.error(`Error fetching data for token ${token}:`, error);
                }
            }
        }

        function displayData(token, data) {
            const dataContainer = document.getElementById('dataContainer');

            const tokenName = Object.keys(symbol_token_dict).find(key => symbol_token_dict[key] === token);
            const today_len = data.data.length - 1;
            const yesterday_len = data.data.length - 2;
            const todayHigh = parseFloat(data.data[today_len]['2']);
            const todayLow = parseFloat(data.data[today_len]['3']);
            const yesterdayHigh = parseFloat(data.data[yesterday_len]['2']);
            const yesterdayLow = parseFloat(data.data[yesterday_len]['3']);
            const todayVol = parseFloat(data.data[today_len]['5']);
            const yesterdayVol = parseFloat(data.data[yesterday_len]['5']);

            const div = document.createElement('div');
            div.innerHTML = ` <br> <p class='share' > <b>${tokenName}:</b> ${JSON.stringify(data.data[today_len]['4'])}</p>
            <p class='share' > <b>Today:</b>  High: ${todayHigh} -- Low: ${todayLow} -- Volume: ${todayVol} </p>
            <p class='share' > <b>Yesterday:</b>  High: ${yesterdayHigh} -- Low: ${yesterdayLow} -- Volume: ${yesterdayVol} </p>
            <hr>`;



            if (todayHigh > yesterdayHigh && todayLow < yesterdayLow) {
                div.style.color = 'green';
                div.style.backgroundColor = 'chartreuse';
            } else {
                div.style.color = 'black';
            }


            if (dataContainer.firstChild) {
                dataContainer.insertBefore(div, dataContainer.firstChild);
            } else {
                dataContainer.appendChild(div);
            }
        }

        const tokens = Object.values(symbol_token_dict);
        console.log(tokens)

        fetchCandleDataSequential(tokens);

        function refreshData() {
            const dataContainer = document.getElementById('dataContainer');
            dataContainer.innerHTML = '';
            fetchCandleDataSequential(tokens);
        }
        document.getElementById('refreshButton').addEventListener('click', refreshData);
    </script>

</body>

</html>