<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeFi</title>
    <style>
        .share {
            text-align: center;
        }
    </style>
</head>

<body>
    <button style="text-align: center; padding: 2%; background-color: aqua;" id="refreshButton">Refresh</button>
    <button style="text-align: center; padding: 2%; background-color: aqua;"><a
            style="text-decoration: none; color: black;" href="/">Stocks</a></button>
    <div id="dataContainer"></div>


    <script>
        const symbol_token_dict = {
            "GNFC29FEB24FUT": "71649",
            "INDHOTEL29FEB24FUT": "71688",
            "MARUTI29FEB24FUT": "71844",
            "INDIACEM29FEB24FUT": "71689",
            "PFC29FEB24FUT": "71868",
            "PNB29FEB24FUT": "71880",
            "PIIND29FEB24FUT": "71879",
            "JSWSTEEL29FEB24FUT": "71829",
            "MANAPPURAM29FEB24FUT": "71842",
            "BIOCON29FEB24FUT": "71489",
            "IDEA29FEB24FUT": "71683",
            "TATAMOTORS29FEB24FUT": "71906",
            "ADANIPORTS29FEB24FUT": "71451",
            "RAMCOCEM29FEB24FUT": "71888",
            "COFORGE29FEB24FUT": "71500",
            "PAGEIND29FEB24FUT": "71864",
            "MARICO29FEB24FUT": "71843",
            "IOC29FEB24FUT": "71697",
            "DEEPAKNTR29FEB24FUT": "71536",
            "DABUR29FEB24FUT": "71530",
            "ESCORTS29FEB24FUT": "71579",
            "UPL29FEB24FUT": "71917",
            "FEDERALBNK29FEB24FUT": "71581",
            "BHARTIARTL29FEB24FUT": "71487",
            "GMRINFRA29FEB24FUT": "71638",
            "DRREDDY29FEB24FUT": "71577",
            "MFSL29FEB24FUT": "71848",
            "BSOFT29FEB24FUT": "71493",
            "BPCL29FEB24FUT": "71491",
            "UBL29FEB24FUT": "71915",
            "RELIANCE29FEB24FUT": "71891",
            "BAJFINANCE29FEB24FUT": "71465",
            "BOSCHLTD29FEB24FUT": "71490",
            "CROMPTON29FEB24FUT": "71527",
            "AARTIIND29FEB24FUT": "71442",
            "NMDC29FEB24FUT": "71859",
            "SRF29FEB24FUT": "71899",
            "SUNTV29FEB24FUT": "71901",
            "EICHERMOT29FEB24FUT": "71578",
            "TITAN29FEB24FUT": "71911",
            "DIXON29FEB24FUT": "71575",
            "ULTRACEMCO29FEB24FUT": "71916",
            "TRENT29FEB24FUT": "71913",
            "L&TFH29FEB24FUT": "71832",
            "SHREECEM29FEB24FUT": "71896",
            "ASIANPAINT29FEB24FUT": "71457",
            "EXIDEIND29FEB24FUT": "71580",
            "IPCALAB29FEB24FUT": "71698",
            "JKCEMENT29FEB24FUT": "71813",
            "BEL29FEB24FUT": "71482",
            "CHOLAFIN29FEB24FUT": "71497",
            "NESTLEIND29FEB24FUT": "71858",
            "IGL29FEB24FUT": "71687",
            "JUBLFOOD29FEB24FUT": "71830",
            "SBILIFE29FEB24FUT": "71894",
            "RECLTD29FEB24FUT": "71890",
            "SIEMENS29FEB24FUT": "71898",
            "RBLBANK29FEB24FUT": "71889",
            "PERSISTENT29FEB24FUT": "71866",
            "GRASIM29FEB24FUT": "71663",
            "AUROPHARMA29FEB24FUT": "71461",
            "BHEL29FEB24FUT": "71488",
            "M&MFIN29FEB24FUT": "71841",
            "TCS29FEB24FUT": "71909",
            "NIFTY29FEB24FUT": "71441",
            "NTPC29FEB24FUT": "71860",
            "VEDL29FEB24FUT": "71918",
            "ICICIPRULI29FEB24FUT": "71682",
            "LTTS29FEB24FUT": "71838",
            "ALKEM29FEB24FUT": "71452",
            "BANKNIFTY29FEB24FUT": "71440",
            "ICICIGI29FEB24FUT": "71681",
            "PEL29FEB24FUT": "71865",
            "TORNTPHARM29FEB24FUT": "71912",
            "PIDILITIND29FEB24FUT": "71878",
            "HINDCOPPER29FEB24FUT": "71677",
            "OBEROIRLTY29FEB24FUT": "71861",
            "HDFCLIFE29FEB24FUT": "71672",
            "ASTRAL29FEB24FUT": "71458",
            "HDFCBANK29FEB24FUT": "71671",
            "NAUKRI29FEB24FUT": "71855",
            "SBIN29FEB24FUT": "71895",
            "CHAMBLFERT29FEB24FUT": "71496",
            "KOTAKBANK29FEB24FUT": "71831",
            "LICHSGFIN29FEB24FUT": "71835",
            "HEROMOTOCO29FEB24FUT": "71673",
            "GUJGASLTD29FEB24FUT": "71664",
            "BAJAJFINSV29FEB24FUT": "71464",
            "GLENMARK29FEB24FUT": "71637",
            "ZEEL29FEB24FUT": "71921",
            "ABCAPITAL29FEB24FUT": "71445",
            "HCLTECH29FEB24FUT": "71669",
            "CUB29FEB24FUT": "71528",
            "MCX29FEB24FUT": "71846",
            "IRCTC29FEB24FUT": "71810",
            "DLF29FEB24FUT": "71576",
            "BERGEPAINT29FEB24FUT": "71483",
            "INDIGO29FEB24FUT": "71691",
            "LUPIN29FEB24FUT": "71839",
            "CIPLA29FEB24FUT": "71498",
            "COLPAL29FEB24FUT": "71511",
            "TATACONSUM29FEB24FUT": "71905",
            "GODREJPROP29FEB24FUT": "71653",
            "GAIL29FEB24FUT": "71582",
            "CONCOR29FEB24FUT": "71512",
            "CANBK29FEB24FUT": "71494",
            "AMBUJACEM29FEB24FUT": "71453",
            "DIVISLAB29FEB24FUT": "71555",
            "GRANULES29FEB24FUT": "71654",
            "BALKRISIND29FEB24FUT": "71466",
            "DELTACORP29FEB24FUT": "71542",
            "HINDUNILVR29FEB24FUT": "71679",
            "IEX29FEB24FUT": "71686",
            "AUBANK29FEB24FUT": "71460",
            "BATAINDIA29FEB24FUT": "71470",
            "HAVELLS29FEB24FUT": "71668",
            "BALRAMCHIN29FEB24FUT": "71467",
            "COROMANDEL29FEB24FUT": "71524",
            "ABBOTINDIA29FEB24FUT": "71444",
            "GODREJCP29FEB24FUT": "71650",
            "IDFC29FEB24FUT": "71684",
            "INDUSTOWER29FEB24FUT": "71695",
            "MUTHOOTFIN29FEB24FUT": "71853",
            "INFY29FEB24FUT": "71696",
            "INDUSINDBK29FEB24FUT": "71692",
            "LTIM29FEB24FUT": "71837",
            "METROPOLIS29FEB24FUT": "71847",
            "LALPATHLAB29FEB24FUT": "71833",
            "NAVINFLUOR29FEB24FUT": "71857",
            "BRITANNIA29FEB24FUT": "71492",
            "HDFCAMC29FEB24FUT": "71670",
            "APOLLOTYRE29FEB24FUT": "71455",
            "M&M29FEB24FUT": "71840",
            "NATIONALUM29FEB24FUT": "71854",
            "IDFCFIRSTB29FEB24FUT": "71685",
            "TATAPOWER29FEB24FUT": "71907",
            "HINDPETRO29FEB24FUT": "71678",
            "DALBHARAT29FEB24FUT": "71535",
            "ABB29FEB24FUT": "71443",
            "CUMMINSIND29FEB24FUT": "71529",
            "PETRONET29FEB24FUT": "71867",
            "ABFRL29FEB24FUT": "71446",
            "TECHM29FEB24FUT": "71910",
            "MOTHERSON29FEB24FUT": "71850",
            "INDIAMART29FEB24FUT": "71690",
            "MPHASIS29FEB24FUT": "71851",
            "BAJAJ-AUTO29FEB24FUT": "71463",
            "TATACOMM29FEB24FUT": "71904",
            "SAIL29FEB24FUT": "71892",
            "JINDALSTEL29FEB24FUT": "71812",
            "COALINDIA29FEB24FUT": "71499",
            "BANDHANBNK29FEB24FUT": "71468",
            "BANKBARODA29FEB24FUT": "71469",
            "LT29FEB24FUT": "71836",
            "ASHOKLEY29FEB24FUT": "71456",
            "POLYCAB29FEB24FUT": "71881",
            "ATUL29FEB24FUT": "71459",
            "SHRIRAMFIN29FEB24FUT": "71897",
            "PVRINOX29FEB24FUT": "71887",
            "HINDALCO29FEB24FUT": "71674",
            "VOLTAS29FEB24FUT": "71919",
            "BHARATFORG29FEB24FUT": "71486",
            "ICICIBANK29FEB24FUT": "71680",
            "OFSS29FEB24FUT": "71862",
            "SBICARD29FEB24FUT": "71893",
            "SUNPHARMA29FEB24FUT": "71900",
            "ACC29FEB24FUT": "71448",
            "CANFINHOME29FEB24FUT": "71495",
            "WIPRO29FEB24FUT": "71920",
            "ITC29FEB24FUT": "71811",
            "ADANIENT29FEB24FUT": "71449",
            "ONGC29FEB24FUT": "71863",
            "MGL29FEB24FUT": "71849",
            "AXISBANK29FEB24FUT": "71462",
            "MCDOWELL-N29FEB24FUT": "71845",
            "POWERGRID29FEB24FUT": "71886",
            "TATACHEM29FEB24FUT": "71903",
            "MIDCPNIFTY26FEB24FUT": "37271",
            "ZYDUSLIFE29FEB24FUT": "71922",
            "HAL29FEB24FUT": "71667",
            "TATASTEEL29FEB24FUT": "71908",
            "TVSMOTOR29FEB24FUT": "71914",
            "FINNIFTY27FEB24FUT": "35086",
            "MRF29FEB24FUT": "71852",
            "SYNGENE29FEB24FUT": "71902",
            "APOLLOHOSP29FEB24FUT": "71454",
            "THIS IS LAST >>>>>>REFRESH__AGAIN>>>>>> LAURUSLABS29FEB24FUT": "71834"
        };

        async function fetchCandleDataSequential(tokens) {
            for (let token of tokens) {
                const tokenName = Object.keys(symbol_token_dict).find(key => symbol_token_dict[key] === token).replace(/-EQ$/, '');
                try {
                    const response = await fetch(`/get_fut_data/${token}/${tokenName}`);
                    const data = await response.json();
                    displayData(token, data);
                } catch (error) {
                    console.error(`Error fetching data for token ${token}:`, error);
                }
            }
        }

        function displayData(token, data) {
            const dataContainer = document.getElementById('dataContainer');

            const tokenName = Object.keys(symbol_token_dict).find(key => symbol_token_dict[key] === token);
            const today_len = data.data.length - 1;
            const yesterday_len = data.data.length - 2;
            const todayHigh = parseFloat(data.data[today_len]['2']);
            const todayLow = parseFloat(data.data[today_len]['3']);
            const yesterdayHigh = parseFloat(data.data[yesterday_len]['2']);
            const yesterdayLow = parseFloat(data.data[yesterday_len]['3']);
            const todayVol = parseFloat(data.data[today_len]['5']);
            const yesterdayVol = parseFloat(data.data[yesterday_len]['5']);

            const div = document.createElement('div');
            div.innerHTML = ` <br> <p class='share' > <b>${tokenName}:</b> ${JSON.stringify(data.data[today_len]['4'])}</p>
            <p class='share' > <b>Today:</b>  High: ${todayHigh} -- Low: ${todayLow} -- Volume: ${todayVol} </p>
            <p class='share' > <b>Yesterday:</b>  High: ${yesterdayHigh} -- Low: ${yesterdayLow} -- Volume: ${yesterdayVol} </p>
            <hr>`;



            if (todayHigh > yesterdayHigh && todayLow < yesterdayLow) {
                div.style.color = 'green';
                div.style.backgroundColor = 'chartreuse';
            } else {
                div.style.color = 'black';
            }


            if (dataContainer.firstChild) {
                dataContainer.insertBefore(div, dataContainer.firstChild);
            } else {
                dataContainer.appendChild(div);
            }
        }

        const tokens = Object.values(symbol_token_dict);
        console.log(tokens)

        fetchCandleDataSequential(tokens);

        function refreshData() {
            const dataContainer = document.getElementById('dataContainer');
            dataContainer.innerHTML = '';
            fetchCandleDataSequential(tokens);
        }
        document.getElementById('refreshButton').addEventListener('click', refreshData);
    </script>

</body>

</html>