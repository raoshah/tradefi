<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeFi</title>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function updateCounter() {
            $.ajax({
                url: '/get_counter',
                method: 'GET',
                success: function(data) {
                    document.getElementById('counter').innerText = data;
                }
            });
        }
        setInterval(updateCounter, 1000); // Update counter every second
    </script> -->
    <!-- <script>
        // Assuming you have the symbol_token_dict available in the frontend

        const symbol_token_dict = {
            "SHREECEM-EQ": "3103",
            "ADANIPORTS-EQ": "15083",
            "BAJFINANCE-EQ": "317"
        };

        // Function to fetch data for a token
        async function fetchCandleDataSequential(tokens) {
            for (let token of tokens) {
                try {
                    const response = await fetch(`/get_candle_data/${token}`);
                    const data = await response.json();
                    console.log(`Data for token ${token}:`, data);
                } catch (error) {
                    console.error(`Error fetching data for token ${token}:`, error);
                }
            }
        }

        // Convert object values to an array of tokens
        const tokens = Object.values(symbol_token_dict);

        // Fetch data sequentially
        fetchCandleDataSequential(tokens);


    </script> -->

</head>

<body>

    <div style="text-align: center;">
        {% for data in candle_data_list %}
        <br style="background-color: chartreuse;">
        <p><b>{{ data.symbol }} :</b>

            {{ data.data[-1][-2] }}
        </p>
        <p>
            <b>Yesterday</b> High: {{ data.data[-2][-4] }} Low: {{ data.data[-2][-3]}}
        </p>
        <p>
            <b>Today </b>
            <span
                style="color: {% if data.data[-1][-4] > data.data[-2][-4] and data.data[-1][-3] < data.data[-2][-3] %}green; background-color: chartreuse {% else %}black{% endif %};">
                High: {{ data.data[-1][-4] }} Low: {{ data.data[-1][-3]}}
            </span>
        </p>
        <hr>
        {% endfor %}
    </div>


    <div id="dataContainer"></div>

    <script>
        const symbol_token_dict = {
            "SHREECEM-EQ": "3103",
            "ADANIPORTS-EQ": "15083",
            "BAJFINANCE-EQ": "317"
        };

        // Function to fetch data for a token
        async function fetchCandleDataSequential(tokens) {
            for (let token of tokens) {
                try {
                    const response = await fetch(`/get_candle_data/${token}`);
                    const data = await response.json();
                    displayData(token, data); // Call function to display data
                } catch (error) {
                    console.error(`Error fetching data for token ${token}:`, error);
                }
            }
        }

        // Function to display data on the HTML page
        function displayData(token, data) {
            const dataContainer = document.getElementById('dataContainer');

            // Create a new div to hold the fetched data
            const div = document.createElement('div');
            div.innerHTML = `<p>Data for token ${token}: ${JSON.stringify(data)}</p>`;

            if (dataContainer.firstChild) {
                dataContainer.insertBefore(div, dataContainer.firstChild);
            } else {
                dataContainer.appendChild(div); // If container is empty, append normally
            }
        }

        // Convert object values to an array of tokens
        const tokens = Object.values(symbol_token_dict);

        // Fetch data sequentially and display on the HTML page
        fetchCandleDataSequential(tokens);
    </script>
</body>

</html>