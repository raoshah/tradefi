<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeFi</title>
    <style>
        .share {
            text-align: center;
        }
    </style>
</head>

<body>

    <div id="dataContainer"></div>

    <script>
        const symbol_token_dict = {
            "TECHM-EQ": "13538",
            "ONGC-EQ": "2475",
            "COALINDIA-EQ": "20374",
            "INDUSINDBK-EQ": "5258",
            "M&M-EQ": "2031",
            "TATASTEEL-EQ": "3499",
            "BAJFINANCE-EQ": "317",
            "SHREECEM-EQ": "3103",
            "HINDALCO-EQ": "1363",
            "AXISBANK-EQ": "5900",
            "GRASIM-EQ": "1232",
            "BAJAJ-AUTO-EQ": "16669",
            "HINDUNILVR-EQ": "1394",
            "LT-EQ": "11483",
            "BRITANNIA-EQ": "547",
            "JSWSTEEL-EQ": "11723",
            "SBIN-EQ": "3045",
            "ICICIBANK-EQ": "4963",
            "POWERGRID-EQ": "14977",
            "HEROMOTOCO-EQ": "1348",
            "SBILIFE-EQ": "21808",
            "BAJAJHLDNG-EQ": "305",
            "ADANIGREEN-EQ": "3563",
            "BAJAJFINSV-EQ": "16675",
            "CIPLA-EQ": "694",
            "UPL-EQ": "11287",
            "ITC-EQ": "1660",
            "TATAMOTORS-EQ": "3456",
            "TATACONSUM-EQ": "3432",
            "BHARTIARTL-EQ": "10604",
            "WIPRO-EQ": "3787",
            "ULTRACEMCO-EQ": "11532",
            "HDFCLIFE-EQ": "467",
            "KOTAKBANK-EQ": "1922",
            "NTPC-EQ": "11630",
            "DIVISLAB-EQ": "10940",
            "TCS-EQ": "11536",
            "NESTLEIND-EQ": "17963",
            "DRREDDY-EQ": "881",
            "ASIANPAINT-EQ": "236",
            "RELIANCE-EQ": "2885",
            "EICHERMOT-EQ": "910",
            "MARUTI-EQ": "10999",
            "INFY-EQ": "1594",
            "HCLTECH-EQ": "7229"
        };

        async function fetchCandleDataSequential(tokens) {
            for (let token of tokens) {
                try {
                    const response = await fetch(`/get_candle_data/${token}`);
                    const data = await response.json();
                    displayData(token, data);
                } catch (error) {
                    console.error(`Error fetching data for token ${token}:`, error);
                }
            }
        }

        function displayData(token, data) {
            const dataContainer = document.getElementById('dataContainer');

            const tokenName = Object.keys(symbol_token_dict).find(key => symbol_token_dict[key] === token);

            const div = document.createElement('div');
            div.innerHTML = ` <br> <p class='share' > <b>${tokenName}:</b> ${JSON.stringify(data.data['4']['4'])}</p>
            <p class='share' > <b>Today:</b>  High: ${JSON.stringify(data.data['4']['2'])} Low: ${JSON.stringify(data.data['4']['3'])} </p>
            <p class='share' > <b>Yesterday:</b>  High: ${JSON.stringify(data.data['3']['2'])} Low: ${JSON.stringify(data.data['3']['3'])} </p>
            <hr>`;

            const todayHigh = parseFloat(data.data['4']['2']);
            const todayLow = parseFloat(data.data['4']['3']);
            const yesterdayHigh = parseFloat(data.data['3']['2']);
            const yesterdayLow = parseFloat(data.data['3']['3']);

            if (todayHigh > yesterdayHigh && todayLow < yesterdayLow) {
                div.style.color = 'green';
                div.style.backgroundColor = 'chartreuse';
            } else {
                div.style.color = 'black';
            }


            if (dataContainer.firstChild) {
                dataContainer.insertBefore(div, dataContainer.firstChild);
            } else {
                dataContainer.appendChild(div);
            }
        }

        const tokens = Object.values(symbol_token_dict);

        fetchCandleDataSequential(tokens);
    </script>

    <div style="text-align: center;">
        {% for data in candle_data_list %}
        <br>
        <p><b>{{ data.symbol }} :</b>

            {{ data.data[-1][-2] }}
        </p>
        <p>
            <b>Yesterday</b> High: {{ data.data[-2][-4] }} Low: {{ data.data[-2][-3]}}
        </p>
        <p>
            <b>Today </b>
            <span
                style="color: {% if data.data[-1][-4] > data.data[-2][-4] and data.data[-1][-3] < data.data[-2][-3] %}green; background-color: chartreuse {% else %}black{% endif %};">
                High: {{ data.data[-1][-4] }} Low: {{ data.data[-1][-3]}}
            </span>
        </p>
        <hr>
        {% endfor %}
    </div>

</body>

</html>